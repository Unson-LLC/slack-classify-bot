# DynamoDB導入によるコスト分析

## 現在の利用状況推定

Slackログとスクリーンショットから推定される利用パターン：
- 1日あたりのファイルアップロード数: 約10-50件
- ピーク時（会議が多い日）: 最大100件/日
- 月間平均: 約1,000件のファイルアップロード

## DynamoDBコスト計算

### 料金体系（us-east-1リージョン）
- **オンデマンド料金（Pay-per-request）**:
  - 書き込みリクエスト: $0.25 / 100万リクエスト
  - 読み取りリクエスト: $0.25 / 100万リクエスト
  - ストレージ: $0.25 / GB/月

### 月間コスト試算

#### シナリオ1: 現在の推定利用量（月1,000件）
```
書き込み操作:
- ファイルアップロード: 1,000件
- 重複チェック失敗による再試行: 100件（10%）
- 合計: 1,100書き込み/月
- コスト: 1,100 × $0.25/1,000,000 = $0.000275

読み取り操作:
- 重複チェック: 2,000件（各ファイルで平均2回チェック）
- コスト: 2,000 × $0.25/1,000,000 = $0.0005

ストレージ:
- 各レコード: 約500バイト
- 月間最大保存量: 1,000件 × 500バイト = 500KB
- TTL（6時間）により常時保存は約100件 = 50KB
- コスト: 実質無視できるレベル（$0.000013）

月間合計: 約$0.0008（0.08円）
```

#### シナリオ2: 中規模利用（月10,000件）
```
書き込み: 11,000 × $0.25/1,000,000 = $0.00275
読み取り: 20,000 × $0.25/1,000,000 = $0.005
ストレージ: 無視できるレベル

月間合計: 約$0.008（0.8円）
```

#### シナリオ3: 大規模利用（月100,000件）
```
書き込み: 110,000 × $0.25/1,000,000 = $0.0275
読み取り: 200,000 × $0.25/1,000,000 = $0.05
ストレージ: 約$0.001

月間合計: 約$0.08（8円）
```

## 現在のLambdaコストとの比較

### 現在のLambda実行による追加コスト（重複実行分）
- 重複実行率: 約50%（ログから推定）
- 追加実行時間: 1,000件 × 50% × 5秒 = 2,500秒/月
- Lambda料金（256MB）: $0.0000000021/100ms
- 追加コスト: 25,000 × $0.0000000021 = $0.0525/月

### DynamoDB導入後の削減効果
- 重複実行がなくなることで: **$0.0525/月の節約**
- DynamoDBコスト: **$0.0008/月の追加**
- **実質的なコスト削減: $0.0517/月（約5円/月の節約）**

## コスト最適化のポイント

1. **TTL設定の重要性**
   - 6時間後に自動削除することでストレージコストを最小化
   - 必要に応じてTTL時間を調整可能

2. **オンデマンド vs プロビジョンド**
   - 現在の利用量ではオンデマンドが最適
   - 月10万件を超える場合はプロビジョンドキャパシティを検討

3. **リージョン選択**
   - us-east-1が最も安価
   - 現在のLambdaと同じリージョンで配置

## 結論

**DynamoDB導入による月間コスト変化**:
- DynamoDB追加コスト: **+$0.0008（約0.08円）**
- Lambda重複実行削減: **-$0.0525（約5.25円）**
- **実質的な削減額: $0.0517/月（約5.17円の節約）**

つまり、DynamoDBを導入することで：
1. **コストは実質的に削減される**
2. **システムの信頼性が向上**（重複投稿の完全防止）
3. **将来的なスケーラビリティが確保**される

現在の利用規模では、DynamoDBのコストは無視できるレベルであり、むしろLambdaの重複実行を防ぐことでコスト削減効果が期待できます。